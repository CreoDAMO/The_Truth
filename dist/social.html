
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Social Features - The Truth NFT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
</head>
<body class="bg-black text-white min-h-screen">
    <div id="social-root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function SocialInterface() {
            const [activeTab, setActiveTab] = useState('referrals');
            const [account, setAccount] = useState(null);
            const [profile, setProfile] = useState(null);
            const [loading, setLoading] = useState(false);

            const connectWallet = async () => {
                if (typeof window.ethereum !== 'undefined') {
                    try {
                        const accounts = await window.ethereum.request({ 
                            method: 'eth_requestAccounts' 
                        });
                        setAccount(accounts[0]);
                        loadProfile(accounts[0]);
                    } catch (error) {
                        console.error('Failed to connect wallet:', error);
                    }
                }
            };

            const loadProfile = async (address) => {
                try {
                    const response = await fetch(`/api/social/profile/${address}`);
                    const profileData = await response.json();
                    setProfile(profileData);
                } catch (error) {
                    console.error('Failed to load profile:', error);
                }
            };

            const generateReferralCode = async () => {
                setLoading(true);
                try {
                    const response = await fetch('/api/social/referral', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            referrerAddress: account,
                            refereeAddress: '0x0000000000000000000000000000000000000000',
                            actionType: 'mint'
                        })
                    });
                    const result = await response.json();
                    alert(`Your referral code: ${result.referralCode}`);
                } catch (error) {
                    alert('Failed to generate referral code: ' + error.message);
                } finally {
                    setLoading(false);
                }
            };

            const shareNFT = async (platform) => {
                setLoading(true);
                try {
                    const response = await fetch('/api/social/share', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            nftId: '1',
                            platform,
                            customMessage: "Just discovered this amazing Truth NFT that perfectly captures the gap between truth and institutional translation!"
                        })
                    });
                    const result = await response.json();
                    window.open(`https://${platform}.com/share?url=${encodeURIComponent(result.shareUrl)}&text=${encodeURIComponent(result.shareText)}`, '_blank');
                } catch (error) {
                    alert('Sharing failed: ' + error.message);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-pink-900 via-black to-purple-900">
                    {/* Header */}
                    <div className="border-b border-pink-500/30 bg-black/50 backdrop-blur-sm">
                        <div className="container mx-auto px-6 py-4">
                            <div className="flex items-center justify-between">
                                <h1 className="text-2xl font-bold bg-gradient-to-r from-pink-400 to-purple-400 bg-clip-text text-transparent">
                                    Social & Viral Features
                                </h1>
                                <div className="flex items-center gap-4">
                                    <a href="/" className="text-pink-400 hover:text-pink-300">← Back to Home</a>
                                    {!account ? (
                                        <button
                                            onClick={connectWallet}
                                            className="bg-pink-600 hover:bg-pink-700 px-4 py-2 rounded-lg"
                                        >
                                            Connect Wallet
                                        </button>
                                    ) : (
                                        <div className="text-sm text-green-400">
                                            {account.slice(0, 6)}...{account.slice(-4)}
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="container mx-auto px-6 py-8">
                        {/* Tab Navigation */}
                        <div className="flex space-x-1 bg-black/50 p-1 rounded-lg mb-8">
                            {[
                                { id: 'referrals', label: 'Referral System' },
                                { id: 'sharing', label: 'Social Sharing' },
                                { id: 'profile', label: 'Collector Profile' },
                                { id: 'events', label: 'Minting Events' }
                            ].map(tab => (
                                <button
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    className={`flex-1 py-3 px-4 rounded-md transition-all ${
                                        activeTab === tab.id
                                            ? 'bg-pink-600 text-white'
                                            : 'text-pink-300 hover:text-white hover:bg-pink-600/30'
                                    }`}
                                >
                                    {tab.label}
                                </button>
                            ))}
                        </div>

                        {/* Referral System */}
                        {activeTab === 'referrals' && (
                            <div className="space-y-8">
                                <div className="bg-black/30 backdrop-blur-sm rounded-xl p-8 border border-pink-500/30">
                                    <h2 className="text-2xl font-bold mb-6 text-pink-300">Referral Rewards</h2>
                                    <div className="grid md:grid-cols-2 gap-8">
                                        <div>
                                            <h3 className="text-lg font-semibold mb-4">How It Works</h3>
                                            <ul className="space-y-3 text-gray-300">
                                                <li className="flex items-center gap-3">
                                                    <span className="text-pink-400">•</span>
                                                    Share your unique referral code
                                                </li>
                                                <li className="flex items-center gap-3">
                                                    <span className="text-pink-400">•</span>
                                                    Earn 0.01 ETH for each NFT mint
                                                </li>
                                                <li className="flex items-center gap-3">
                                                    <span className="text-pink-400">•</span>
                                                    Get $10 for subscription referrals
                                                </li>
                                                <li className="flex items-center gap-3">
                                                    <span className="text-pink-400">•</span>
                                                    Your friends get discounts too!
                                                </li>
                                            </ul>
                                        </div>
                                        <div className="space-y-4">
                                            <div className="bg-pink-900/30 p-6 rounded-lg">
                                                <h4 className="font-semibold mb-4">Your Referral Stats</h4>
                                                {profile ? (
                                                    <div className="grid grid-cols-2 gap-4 text-center">
                                                        <div>
                                                            <div className="text-2xl font-bold text-pink-400">{profile.referrals}</div>
                                                            <div className="text-sm text-gray-400">Total Referrals</div>
                                                        </div>
                                                        <div>
                                                            <div className="text-2xl font-bold text-green-400">$127.50</div>
                                                            <div className="text-sm text-gray-400">Earnings</div>
                                                        </div>
                                                    </div>
                                                ) : (
                                                    <div className="text-center text-gray-400">Connect wallet to view stats</div>
                                                )}
                                            </div>
                                            <button
                                                onClick={generateReferralCode}
                                                disabled={!account || loading}
                                                className="w-full bg-pink-600 hover:bg-pink-700 disabled:opacity-50 py-3 rounded-lg"
                                            >
                                                {loading ? 'Generating...' : 'Generate Referral Code'}
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                {/* Reward Tiers */}
                                <div className="bg-black/30 backdrop-blur-sm rounded-xl p-8 border border-pink-500/30">
                                    <h3 className="text-xl font-bold mb-6 text-pink-300">Reward Tiers</h3>
                                    <div className="grid md:grid-cols-3 gap-6">
                                        {[
                                            { title: 'Bronze Referrer', refs: '1-5', reward: '1% bonus', color: 'amber' },
                                            { title: 'Silver Referrer', refs: '6-15', reward: '2% bonus', color: 'gray' },
                                            { title: 'Gold Referrer', refs: '16+', reward: '3% bonus', color: 'yellow' }
                                        ].map(tier => (
                                            <div key={tier.title} className={`bg-${tier.color}-900/30 p-6 rounded-lg border border-${tier.color}-500/30`}>
                                                <h4 className="font-semibold mb-2">{tier.title}</h4>
                                                <div className="text-sm text-gray-400 mb-2">{tier.refs} referrals</div>
                                                <div className={`text-${tier.color}-400 font-bold`}>{tier.reward}</div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Social Sharing */}
                        {activeTab === 'sharing' && (
                            <div className="bg-black/30 backdrop-blur-sm rounded-xl p-8 border border-pink-500/30">
                                <h2 className="text-2xl font-bold mb-6 text-pink-300">Social Sharing Tools</h2>
                                <div className="grid md:grid-cols-2 gap-8">
                                    <div>
                                        <h3 className="text-lg font-semibold mb-4">Share Your Truth</h3>
                                        <p className="text-gray-300 mb-6">
                                            Share your NFT collection and philosophical insights across social media with 
                                            beautiful embedded previews and custom messaging.
                                        </p>
                                        <div className="space-y-3">
                                            {[
                                                { platform: 'twitter', name: 'Twitter', icon: '🐦', color: 'blue' },
                                                { platform: 'facebook', name: 'Facebook', icon: '📘', color: 'blue' },
                                                { platform: 'linkedin', name: 'LinkedIn', icon: '💼', color: 'blue' },
                                                { platform: 'instagram', name: 'Instagram', icon: '📷', color: 'pink' }
                                            ].map(platform => (
                                                <button
                                                    key={platform.platform}
                                                    onClick={() => shareNFT(platform.platform)}
                                                    disabled={loading}
                                                    className={`w-full bg-${platform.color}-600 hover:bg-${platform.color}-700 disabled:opacity-50 py-3 px-4 rounded-lg flex items-center gap-3`}
                                                >
                                                    <span>{platform.icon}</span>
                                                    Share on {platform.name}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                    <div className="bg-purple-900/30 p-6 rounded-lg">
                                        <h4 className="font-semibold mb-4">Custom Share Message</h4>
                                        <textarea
                                            className="w-full bg-black/50 border border-purple-500/30 rounded-lg px-4 py-3 mb-4"
                                            rows={4}
                                            placeholder="Customize your share message..."
                                            defaultValue="Just discovered this amazing Truth NFT that perfectly captures the gap between truth and institutional translation!"
                                        />
                                        <div className="bg-black/50 p-4 rounded border border-purple-500/20">
                                            <h5 className="text-sm font-semibold mb-2">Preview:</h5>
                                            <div className="text-xs text-gray-400">
                                                🔮 The Truth NFT #1<br/>
                                                "Where philosophy meets blockchain"<br/>
                                                📊 Truth Score: 94.7%<br/>
                                                🌟 Philosophy Alignment: Deep
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Collector Profile */}
                        {activeTab === 'profile' && (
                            <div className="bg-black/30 backdrop-blur-sm rounded-xl p-8 border border-pink-500/30">
                                <h2 className="text-2xl font-bold mb-6 text-pink-300">Your Collector Profile</h2>
                                {profile ? (
                                    <div className="grid md:grid-cols-2 gap-8">
                                        <div className="space-y-6">
                                            <div className="bg-purple-900/30 p-6 rounded-lg">
                                                <h3 className="text-lg font-semibold mb-4">Collection Stats</h3>
                                                <div className="grid grid-cols-2 gap-4">
                                                    <div className="text-center">
                                                        <div className="text-2xl font-bold text-purple-400">{profile.nftCount}</div>
                                                        <div className="text-sm text-gray-400">NFTs Owned</div>
                                                    </div>
                                                    <div className="text-center">
                                                        <div className="text-2xl font-bold text-blue-400">{profile.truthTokens}</div>
                                                        <div className="text-sm text-gray-400">TRUTH Tokens</div>
                                                    </div>
                                                    <div className="text-center">
                                                        <div className="text-2xl font-bold text-pink-400">{profile.creatorTokens}</div>
                                                        <div className="text-sm text-gray-400">Creator Tokens</div>
                                                    </div>
                                                    <div className="text-center">
                                                        <div className="text-2xl font-bold text-green-400">{profile.philosophyAlignment}%</div>
                                                        <div className="text-sm text-gray-400">Philosophy Alignment</div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div className="bg-black/50 p-6 rounded-lg">
                                                <h4 className="font-semibold mb-4">Collections</h4>
                                                <div className="space-y-3">
                                                    {profile.collections.map((collection, index) => (
                                                        <div key={index} className="flex justify-between items-center">
                                                            <span>{collection.name}</span>
                                                            <div className="text-right">
                                                                <div className="font-semibold">{collection.count}</div>
                                                                <div className="text-xs text-gray-400">{collection.rarity}</div>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div className="space-y-6">
                                            <div className="bg-green-900/30 p-6 rounded-lg">
                                                <h4 className="font-semibold mb-4">Achievements</h4>
                                                <div className="space-y-2">
                                                    {profile.achievements.map((achievement, index) => (
                                                        <div key={index} className="flex items-center gap-3">
                                                            <span className="text-green-400">🏆</span>
                                                            <span>{achievement}</span>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>
                                            
                                            <div className="bg-orange-900/30 p-6 rounded-lg">
                                                <h4 className="font-semibold mb-4">Community Impact</h4>
                                                <div className="space-y-3">
                                                    <div className="flex justify-between">
                                                        <span>Referrals Made</span>
                                                        <span className="font-semibold">{profile.referrals}</span>
                                                    </div>
                                                    <div className="flex justify-between">
                                                        <span>Content Contributions</span>
                                                        <span className="font-semibold">{profile.contentContributions}</span>
                                                    </div>
                                                    <div className="flex justify-between">
                                                        <span>Member Since</span>
                                                        <span className="font-semibold">{profile.joinDate}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="text-center py-12">
                                        <p className="text-gray-400 mb-4">Connect your wallet to view your collector profile</p>
                                        <button
                                            onClick={connectWallet}
                                            className="bg-pink-600 hover:bg-pink-700 px-6 py-3 rounded-lg"
                                        >
                                            Connect Wallet
                                        </button>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* Minting Events */}
                        {activeTab === 'events' && (
                            <div className="space-y-8">
                                <div className="bg-black/30 backdrop-blur-sm rounded-xl p-8 border border-pink-500/30">
                                    <h2 className="text-2xl font-bold mb-6 text-pink-300">Live Minting Events</h2>
                                    <div className="grid md:grid-cols-2 gap-8">
                                        <div>
                                            <h3 className="text-lg font-semibold mb-4">Upcoming Events</h3>
                                            <div className="space-y-4">
                                                <div className="bg-purple-900/30 p-4 rounded-lg border border-purple-500/30">
                                                    <h4 className="font-semibold">Truth Milestone: 1000 Holders</h4>
                                                    <p className="text-sm text-gray-400 mb-2">January 25, 2024 at 3:00 PM UTC</p>
                                                    <p className="text-sm">Live celebration when we reach 1000 unique holders</p>
                                                    <div className="mt-3 bg-black/50 rounded-full h-2">
                                                        <div className="bg-purple-500 h-2 rounded-full" style={{width: '87%'}}></div>
                                                    </div>
                                                    <div className="text-xs text-gray-400 mt-1">870/1000 holders</div>
                                                </div>
                                                
                                                <div className="bg-blue-900/30 p-4 rounded-lg border border-blue-500/30">
                                                    <h4 className="font-semibold">Philosophy Discussion Series</h4>
                                                    <p className="text-sm text-gray-400 mb-2">February 1, 2024 at 7:00 PM UTC</p>
                                                    <p className="text-sm">Monthly live discussion on Truth and institutional gaps</p>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <h3 className="text-lg font-semibold mb-4">Past Events</h3>
                                            <div className="space-y-4">
                                                <div className="bg-green-900/30 p-4 rounded-lg border border-green-500/30 opacity-60">
                                                    <h4 className="font-semibold">Launch Ceremony ✅</h4>
                                                    <p className="text-sm text-gray-400">December 15, 2023</p>
                                                    <p className="text-sm">77 NFTs minted in first hour</p>
                                                </div>
                                                
                                                <div className="bg-green-900/30 p-4 rounded-lg border border-green-500/30 opacity-60">
                                                    <h4 className="font-semibold">500 Holders Celebration ✅</h4>
                                                    <p className="text-sm text-gray-400">January 10, 2024</p>
                                                    <p className="text-sm">Community milestone reached</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="bg-black/30 backdrop-blur-sm rounded-xl p-8 border border-pink-500/30">
                                    <h3 className="text-xl font-bold mb-6 text-pink-300">Event Notifications</h3>
                                    <div className="grid md:grid-cols-2 gap-6">
                                        <div>
                                            <label className="flex items-center gap-3 mb-3">
                                                <input type="checkbox" className="rounded" defaultChecked />
                                                <span>Email notifications</span>
                                            </label>
                                            <label className="flex items-center gap-3 mb-3">
                                                <input type="checkbox" className="rounded" defaultChecked />
                                                <span>Discord announcements</span>
                                            </label>
                                            <label className="flex items-center gap-3 mb-3">
                                                <input type="checkbox" className="rounded" />
                                                <span>SMS reminders</span>
                                            </label>
                                        </div>
                                        <div className="bg-pink-900/30 p-4 rounded-lg">
                                            <h4 className="font-semibold mb-2">Next Event in:</h4>
                                            <div className="text-2xl font-bold text-pink-400">3d 14h 27m</div>
                                            <button className="w-full bg-pink-600 hover:bg-pink-700 py-2 rounded mt-4">
                                                Set Reminder
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<SocialInterface />, document.getElementById('social-root'));
    </script>
</body>
</html>

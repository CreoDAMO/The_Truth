
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Payments - The Truth NFT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
</head>
<body class="bg-black text-white min-h-screen">
    <div id="payments-root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function PaymentsInterface() {
            const [activeTab, setActiveTab] = useState('gasless');
            const [account, setAccount] = useState(null);
            const [loading, setLoading] = useState(false);

            const connectWallet = async () => {
                if (typeof window.ethereum !== 'undefined') {
                    try {
                        const accounts = await window.ethereum.request({ 
                            method: 'eth_requestAccounts' 
                        });
                        setAccount(accounts[0]);
                    } catch (error) {
                        console.error('Failed to connect wallet:', error);
                    }
                }
            };

            const gaslessMint = async () => {
                setLoading(true);
                try {
                    const response = await fetch('/api/payments/gasless-mint', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            recipient: account,
                            quantity: 1,
                            tokenType: 'truth'
                        })
                    });
                    const result = await response.json();
                    alert(`Gasless mint initiated! ID: ${result.mintId}`);
                } catch (error) {
                    alert('Gasless mint failed: ' + error.message);
                } finally {
                    setLoading(false);
                }
            };

            const fiatToNFT = async (formData) => {
                setLoading(true);
                try {
                    const response = await fetch('/api/payments/fiat-to-nft', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData)
                    });
                    const result = await response.json();
                    alert(`Success! New wallet: ${result.walletAddress}`);
                } catch (error) {
                    alert('Fiat conversion failed: ' + error.message);
                } finally {
                    setLoading(false);
                }
            };

            const createSubscription = async (plan) => {
                setLoading(true);
                try {
                    const response = await fetch('/api/payments/subscription', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            address: account,
                            plan,
                            paymentMethod: 'card'
                        })
                    });
                    const result = await response.json();
                    alert(`Subscription created! Plan: ${plan}`);
                } catch (error) {
                    alert('Subscription failed: ' + error.message);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-purple-900 via-black to-blue-900">
                    {/* Header */}
                    <div className="border-b border-purple-500/30 bg-black/50 backdrop-blur-sm">
                        <div className="container mx-auto px-6 py-4">
                            <div className="flex items-center justify-between">
                                <h1 className="text-2xl font-bold bg-gradient-to-r from-purple-400 to-blue-400 bg-clip-text text-transparent">
                                    Enhanced Payment Infrastructure
                                </h1>
                                <div className="flex items-center gap-4">
                                    <a href="/" className="text-purple-400 hover:text-purple-300">← Back to Home</a>
                                    {!account ? (
                                        <button
                                            onClick={connectWallet}
                                            className="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg"
                                        >
                                            Connect Wallet
                                        </button>
                                    ) : (
                                        <div className="text-sm text-green-400">
                                            {account.slice(0, 6)}...{account.slice(-4)}
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="container mx-auto px-6 py-8">
                        {/* Tab Navigation */}
                        <div className="flex space-x-1 bg-black/50 p-1 rounded-lg mb-8">
                            {[
                                { id: 'gasless', label: 'Gasless Minting' },
                                { id: 'fiat', label: 'Fiat to NFT' },
                                { id: 'subscription', label: 'Subscriptions' },
                                { id: 'crypto', label: 'Multi-Token' }
                            ].map(tab => (
                                <button
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    className={`flex-1 py-3 px-4 rounded-md transition-all ${
                                        activeTab === tab.id
                                            ? 'bg-purple-600 text-white'
                                            : 'text-purple-300 hover:text-white hover:bg-purple-600/30'
                                    }`}
                                >
                                    {tab.label}
                                </button>
                            ))}
                        </div>

                        {/* Gasless Minting */}
                        {activeTab === 'gasless' && (
                            <div className="bg-black/30 backdrop-blur-sm rounded-xl p-8 border border-purple-500/30">
                                <h2 className="text-2xl font-bold mb-6 text-purple-300">Gasless Minting</h2>
                                <div className="grid md:grid-cols-2 gap-8">
                                    <div>
                                        <h3 className="text-lg font-semibold mb-4">How It Works</h3>
                                        <ul className="space-y-2 text-gray-300">
                                            <li>• No ETH required for gas fees</li>
                                            <li>• Meta-transactions sponsored by the platform</li>
                                            <li>• Instant minting without blockchain complexity</li>
                                            <li>• Perfect for new Web3 users</li>
                                        </ul>
                                    </div>
                                    <div className="space-y-4">
                                        <div className="bg-purple-900/30 p-4 rounded-lg">
                                            <h4 className="font-semibold mb-2">The Truth NFT</h4>
                                            <p className="text-sm text-gray-400 mb-4">Original collection - 0.0777 ETH</p>
                                            <button
                                                onClick={gaslessMint}
                                                disabled={!account || loading}
                                                className="w-full bg-purple-600 hover:bg-purple-700 disabled:opacity-50 py-3 rounded-lg"
                                            >
                                                {loading ? 'Processing...' : 'Gasless Mint'}
                                            </button>
                                        </div>
                                        <div className="bg-blue-900/30 p-4 rounded-lg">
                                            <h4 className="font-semibold mb-2">Bonus Gift</h4>
                                            <p className="text-sm text-gray-400 mb-4">Community collection - 0.039 ETH</p>
                                            <button
                                                onClick={gaslessMint}
                                                disabled={!account || loading}
                                                className="w-full bg-blue-600 hover:bg-blue-700 disabled:opacity-50 py-3 rounded-lg"
                                            >
                                                {loading ? 'Processing...' : 'Gasless Mint'}
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Fiat to NFT */}
                        {activeTab === 'fiat' && (
                            <div className="bg-black/30 backdrop-blur-sm rounded-xl p-8 border border-purple-500/30">
                                <h2 className="text-2xl font-bold mb-6 text-purple-300">Direct Fiat to NFT</h2>
                                <div className="grid md:grid-cols-2 gap-8">
                                    <div>
                                        <h3 className="text-lg font-semibold mb-4">No Crypto? No Problem!</h3>
                                        <ul className="space-y-2 text-gray-300 mb-6">
                                            <li>• Pay with credit/debit card</li>
                                            <li>• Automatic wallet creation</li>
                                            <li>• Secure private key backup</li>
                                            <li>• Instant NFT delivery</li>
                                        </ul>
                                        <div className="bg-yellow-900/30 p-4 rounded-lg">
                                            <p className="text-yellow-300 text-sm">
                                                🔐 Your wallet will be created automatically and securely backed up. 
                                                You'll receive your private key via encrypted email.
                                            </p>
                                        </div>
                                    </div>
                                    <div className="space-y-4">
                                        <input
                                            type="email"
                                            placeholder="Email address"
                                            className="w-full bg-black/50 border border-purple-500/30 rounded-lg px-4 py-3"
                                        />
                                        <input
                                            type="text"
                                            placeholder="Card number"
                                            className="w-full bg-black/50 border border-purple-500/30 rounded-lg px-4 py-3"
                                        />
                                        <div className="grid grid-cols-2 gap-4">
                                            <input
                                                type="text"
                                                placeholder="MM/YY"
                                                className="bg-black/50 border border-purple-500/30 rounded-lg px-4 py-3"
                                            />
                                            <input
                                                type="text"
                                                placeholder="CVC"
                                                className="bg-black/50 border border-purple-500/30 rounded-lg px-4 py-3"
                                            />
                                        </div>
                                        <select className="w-full bg-black/50 border border-purple-500/30 rounded-lg px-4 py-3">
                                            <option value="truth">The Truth NFT - $75</option>
                                            <option value="bonus">Bonus Gift NFT - $38</option>
                                        </select>
                                        <button
                                            onClick={() => fiatToNFT({
                                                email: 'user@example.com',
                                                cardToken: 'card_token',
                                                nftType: 'truth',
                                                quantity: 1
                                            })}
                                            disabled={loading}
                                            className="w-full bg-green-600 hover:bg-green-700 disabled:opacity-50 py-3 rounded-lg"
                                        >
                                            {loading ? 'Processing...' : 'Purchase with Card'}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Subscriptions */}
                        {activeTab === 'subscription' && (
                            <div className="bg-black/30 backdrop-blur-sm rounded-xl p-8 border border-purple-500/30">
                                <h2 className="text-2xl font-bold mb-6 text-purple-300">Philosophy Subscriptions</h2>
                                <div className="grid md:grid-cols-2 gap-8">
                                    <div className="bg-gradient-to-br from-purple-900/50 to-purple-800/30 p-6 rounded-xl border border-purple-500/30">
                                        <h3 className="text-xl font-bold mb-4">Monthly Access</h3>
                                        <div className="text-3xl font-bold mb-4">$29.99<span className="text-lg font-normal">/month</span></div>
                                        <ul className="space-y-2 text-gray-300 mb-6">
                                            <li>• Basic content library access</li>
                                            <li>• Community Discord access</li>
                                            <li>• Monthly philosophy sessions</li>
                                            <li>• Email newsletter</li>
                                        </ul>
                                        <button
                                            onClick={() => createSubscription('monthly')}
                                            disabled={!account || loading}
                                            className="w-full bg-purple-600 hover:bg-purple-700 disabled:opacity-50 py-3 rounded-lg"
                                        >
                                            {loading ? 'Processing...' : 'Subscribe Monthly'}
                                        </button>
                                    </div>
                                    <div className="bg-gradient-to-br from-gold-900/50 to-yellow-800/30 p-6 rounded-xl border border-yellow-500/30">
                                        <h3 className="text-xl font-bold mb-4">Yearly Access</h3>
                                        <div className="text-3xl font-bold mb-4">$299.99<span className="text-lg font-normal">/year</span></div>
                                        <ul className="space-y-2 text-gray-300 mb-6">
                                            <li>• Full content library access</li>
                                            <li>• Premium Discord channels</li>
                                            <li>• Weekly live sessions</li>
                                            <li>• Quarterly NFT airdrops</li>
                                            <li>• Governance voting rights</li>
                                            <li>• Direct creator access</li>
                                        </ul>
                                        <button
                                            onClick={() => createSubscription('yearly')}
                                            disabled={!account || loading}
                                            className="w-full bg-yellow-600 hover:bg-yellow-700 disabled:opacity-50 py-3 rounded-lg"
                                        >
                                            {loading ? 'Processing...' : 'Subscribe Yearly'}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* Multi-Token Payments */}
                        {activeTab === 'crypto' && (
                            <div className="bg-black/30 backdrop-blur-sm rounded-xl p-8 border border-purple-500/30">
                                <h2 className="text-2xl font-bold mb-6 text-purple-300">Multi-Token Payments</h2>
                                <div className="grid md:grid-cols-3 gap-6">
                                    {[
                                        { symbol: 'USDC', name: 'USD Coin', price: '77.00', icon: '💵' },
                                        { symbol: 'DAI', name: 'DAI Stablecoin', price: '77.00', icon: '💰' },
                                        { symbol: 'WETH', name: 'Wrapped ETH', price: '0.0777', icon: '⟐' },
                                        { symbol: 'TRUTH', name: 'Truth Token', price: '1000', icon: '🔮' },
                                        { symbol: 'MATIC', name: 'Polygon', price: '150', icon: '🟣' },
                                        { symbol: 'AVAX', name: 'Avalanche', price: '5.5', icon: '🔺' }
                                    ].map(token => (
                                        <div key={token.symbol} className="bg-black/50 p-4 rounded-lg border border-purple-500/20">
                                            <div className="flex items-center gap-3 mb-3">
                                                <span className="text-2xl">{token.icon}</span>
                                                <div>
                                                    <div className="font-semibold">{token.symbol}</div>
                                                    <div className="text-sm text-gray-400">{token.name}</div>
                                                </div>
                                            </div>
                                            <div className="text-lg font-bold mb-3">{token.price} {token.symbol}</div>
                                            <button
                                                disabled={!account || loading}
                                                className="w-full bg-purple-600 hover:bg-purple-700 disabled:opacity-50 py-2 rounded text-sm"
                                            >
                                                Pay with {token.symbol}
                                            </button>
                                        </div>
                                    ))}
                                </div>
                                <div className="mt-8 bg-blue-900/30 p-4 rounded-lg">
                                    <h4 className="font-semibold mb-2 text-blue-300">Cross-Chain Support</h4>
                                    <p className="text-sm text-gray-300">
                                        We support payments on Ethereum, Base, Polygon, Avalanche, and Arbitrum networks. 
                                        Choose your preferred network and token for seamless transactions.
                                    </p>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<PaymentsInterface />, document.getElementById('payments-root'));
    </script>
</body>
</html>

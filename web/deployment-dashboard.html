
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Truth NFT - Advanced Deployment Command Center</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
    <script src="contract-config.js"></script>
    <script src="deploy-with-metamask.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .glass { 
            background: rgba(255, 255, 255, 0.1); 
            backdrop-filter: blur(10px); 
            border: 1px solid rgba(255, 255, 255, 0.2); 
        }
        body { 
            background: linear-gradient(135deg, #1a1a1a, #2d2d2d, #1a1a1a); 
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .pulse-glow {
            animation: pulseGlow 2s ease-in-out infinite;
        }
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(0, 212, 255, 0.3); }
            50% { box-shadow: 0 0 30px rgba(0, 212, 255, 0.6); }
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-deployed { background: #4ade80; }
        .status-deploying { background: #fbbf24; animation: pulse 2s infinite; }
        .status-verifying { background: #8b5cf6; animation: pulse 2s infinite; }
        .status-verified { background: #10b981; }
        .status-failed { background: #ef4444; }
        .status-not-deployed { background: #6b7280; }
        .deployment-card {
            transition: all 0.3s ease;
        }
        .deployment-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        .progress-bar {
            background: linear-gradient(90deg, #00d4ff, #090979);
            height: 8px;
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        .deployment-step {
            padding: 12px;
            border-left: 3px solid transparent;
            margin: 8px 0;
            border-radius: 0 8px 8px 0;
            transition: all 0.3s ease;
        }
        .step-pending { 
            background: rgba(107, 114, 128, 0.2); 
            border-left-color: #6b7280; 
        }
        .step-active { 
            background: rgba(251, 191, 36, 0.2); 
            border-left-color: #fbbf24; 
            animation: pulse 2s infinite;
        }
        .step-completed { 
            background: rgba(34, 197, 94, 0.2); 
            border-left-color: #22c55e; 
        }
        .step-failed { 
            background: rgba(239, 68, 68, 0.2); 
            border-left-color: #ef4444; 
        }
        .network-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: bold;
            margin-left: 8px;
        }
        .badge-base { background: #0052ff; color: white; }
        .badge-zora { background: #000; color: white; }
        .badge-mainnet { background: #627eea; color: white; }
        .contract-timeline {
            position: relative;
            padding-left: 30px;
        }
        .contract-timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, #00d4ff, #090979);
        }
        .timeline-item {
            position: relative;
            margin-bottom: 20px;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -23px;
            top: 6px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #00d4ff;
            border: 2px solid #1a1a1a;
        }
        .gas-tracker {
            background: linear-gradient(45deg, rgba(251, 191, 36, 0.1), rgba(139, 92, 246, 0.1));
            border: 1px solid rgba(251, 191, 36, 0.3);
        }
        .verification-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: bold;
            margin-top: 4px;
        }
        .verified { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
        .verifying { background: rgba(139, 92, 246, 0.2); color: #8b5cf6; }
        .unverified { background: rgba(107, 114, 128, 0.2); color: #6b7280; }
        .contract-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin-top: 12px;
        }
        .metric-item {
            text-align: center;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }
        .metric-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #00d4ff;
        }
        .metric-label {
            font-size: 0.7rem;
            opacity: 0.8;
            text-transform: uppercase;
        }
    </style>
</head>
<body class="min-h-screen text-white">
    <div class="max-w-7xl mx-auto p-6">
        <!-- Enhanced Header with Live Status -->
        <div class="text-center mb-8">
            <h1 class="text-5xl font-bold mb-4 bg-gradient-to-r from-yellow-400 via-orange-500 to-red-500 bg-clip-text text-transparent">
                üöÄ Deployment Command Center
            </h1>
            <p class="text-xl opacity-80">Advanced Web3 ecosystem deployment and verification tracking</p>
            <div class="flex justify-center items-center mt-4 space-x-6">
                <div class="flex items-center">
                    <span class="status-indicator" id="systemStatus"></span>
                    <span id="systemStatusText">Initializing...</span>
                </div>
                <div class="flex items-center">
                    <i class="fas fa-clock mr-2"></i>
                    <span id="lastUpdate">Never</span>
                </div>
                <div class="flex items-center">
                    <i class="fas fa-network-wired mr-2"></i>
                    <span id="currentNetwork">Base</span>
                </div>
            </div>
        </div>

        <!-- Real-time Enhanced Status Overview -->
        <div class="glass rounded-xl p-6 mb-8 pulse-glow">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-semibold flex items-center">
                    <i class="fas fa-tachometer-alt mr-3"></i>Ecosystem Status
                </h2>
                <div class="flex space-x-3">
                    <button onclick="refreshAllStatus()" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition-colors">
                        <i class="fas fa-sync-alt mr-2"></i>Refresh All
                    </button>
                    <button onclick="toggleAutoRefresh()" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg transition-colors" id="autoRefreshBtn">
                        <i class="fas fa-pause mr-2"></i>Auto: ON
                    </button>
                </div>
            </div>
            
            <div class="grid md:grid-cols-6 gap-4">
                <div class="text-center">
                    <div class="text-3xl font-bold text-green-400" id="contractsDeployed">0</div>
                    <div class="text-xs opacity-60">Deployed</div>
                    <div class="w-full bg-gray-700 rounded-full h-2 mt-2">
                        <div class="progress-bar" id="contractProgress" style="width: 0%"></div>
                    </div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-bold text-yellow-400" id="contractsDeploying">0</div>
                    <div class="text-xs opacity-60">Deploying</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-bold text-purple-400" id="contractsVerifying">0</div>
                    <div class="text-xs opacity-60">Verifying</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-bold text-emerald-400" id="contractsVerified">0</div>
                    <div class="text-xs opacity-60">Verified</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-bold text-cyan-400" id="totalGasUsed">0</div>
                    <div class="text-xs opacity-60">Gas Used</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-bold text-indigo-400" id="totalValue">$0</div>
                    <div class="text-xs opacity-60">TVL</div>
                </div>
            </div>
        </div>

        <!-- Enhanced Contract Grid with Deployment Tracking -->
        <div class="grid xl:grid-cols-2 gap-8 mb-8">
            <div class="glass rounded-xl p-6">
                <h3 class="text-xl font-semibold mb-4 flex items-center">
                    <i class="fas fa-code mr-3"></i>Smart Contracts
                    <span class="ml-auto text-sm opacity-60" id="contractUpdateTime">Updated: Never</span>
                </h3>
                <div id="contractGrid" class="space-y-4">
                    <!-- Enhanced contract cards will be dynamically generated -->
                </div>
            </div>

            <div class="glass rounded-xl p-6">
                <h3 class="text-xl font-semibold mb-4 flex items-center">
                    <i class="fas fa-rocket mr-3"></i>Active Deployments
                </h3>
                <div id="activeDeployments" class="space-y-4">
                    <div class="text-center opacity-60 py-8">
                        <i class="fas fa-rocket text-4xl mb-3"></i>
                        <div>No active deployments</div>
                        <div class="text-sm">Deploy a contract to see live tracking</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gas Tracker and Network Stats -->
        <div class="grid lg:grid-cols-3 gap-6 mb-8">
            <!-- Enhanced Gas Tracker -->
            <div class="glass rounded-xl p-6 gas-tracker">
                <h3 class="text-xl font-semibold mb-4 flex items-center">
                    <i class="fas fa-bolt mr-3 text-yellow-400"></i>Gas Analytics
                </h3>
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="text-sm">Current Gas:</span>
                        <span id="currentGas" class="font-bold text-yellow-400">-- gwei</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm">Optimal Time:</span>
                        <span id="optimalTime" class="font-bold text-green-400">Loading...</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm">Estimated Cost:</span>
                        <span id="estimatedCost" class="font-bold text-blue-400">$-- USD</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm">24h Average:</span>
                        <span id="averageGas" class="font-bold text-purple-400">-- gwei</span>
                    </div>
                </div>
                <button onclick="optimizeGas()" class="w-full mt-4 bg-gradient-to-r from-yellow-500 to-orange-600 hover:from-yellow-600 hover:to-orange-700 px-4 py-2 rounded-lg font-semibold transition-all">
                    <i class="fas fa-magic mr-2"></i>Optimize Timing
                </button>
            </div>

            <!-- Network Health -->
            <div class="glass rounded-xl p-6">
                <h3 class="text-xl font-semibold mb-4 flex items-center">
                    <i class="fas fa-network-wired mr-3 text-green-400"></i>Network Health
                </h3>
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="text-sm">Base Network:</span>
                        <span id="baseStatus" class="font-bold text-green-400">üü¢ Online</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm">Block Height:</span>
                        <span id="blockHeight" class="font-bold">Loading...</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm">Block Time:</span>
                        <span id="blockTime" class="font-bold">~2s</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-sm">Network Load:</span>
                        <span id="networkLoad" class="font-bold text-yellow-400">Normal</span>
                    </div>
                </div>
                <button onclick="checkNetworkHealth()" class="w-full mt-4 bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg font-semibold transition-colors">
                    <i class="fas fa-heartbeat mr-2"></i>Health Check
                </button>
            </div>

            <!-- Verification Center -->
            <div class="glass rounded-xl p-6">
                <h3 class="text-xl font-semibold mb-4 flex items-center">
                    <i class="fas fa-shield-alt mr-3 text-purple-400"></i>Verification Center
                </h3>
                <div id="verificationStatus" class="space-y-3">
                    <div class="text-center opacity-60 py-4">
                        <i class="fas fa-shield-alt text-3xl mb-2"></i>
                        <div>No contracts to verify</div>
                    </div>
                </div>
                <button onclick="verifyAllContracts()" class="w-full mt-4 bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg font-semibold transition-colors">
                    <i class="fas fa-check-double mr-2"></i>Verify All
                </button>
            </div>
        </div>

        <!-- Contract Deployment Timeline -->
        <div class="glass rounded-xl p-6 mb-8">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-semibold flex items-center">
                    <i class="fas fa-history mr-3"></i>Deployment Timeline
                </h3>
                <button onclick="exportTimeline()" class="text-blue-400 hover:text-blue-300 transition-colors">
                    <i class="fas fa-download mr-2"></i>Export
                </button>
            </div>
            <div id="deploymentTimeline" class="contract-timeline">
                <div class="timeline-item">
                    <div class="text-sm opacity-80">System initialized</div>
                    <div class="text-xs opacity-60" id="initTime"></div>
                </div>
            </div>
        </div>

        <!-- Real-time Enhanced Logs -->
        <div class="glass rounded-xl p-6 mb-8">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-xl font-semibold flex items-center">
                    <i class="fas fa-terminal mr-3"></i>Deployment Logs
                    <span class="ml-4 text-sm opacity-60" id="logCount">(0 entries)</span>
                </h3>
                <div class="flex space-x-3">
                    <select id="logFilter" onchange="filterLogs()" class="bg-gray-800 border border-gray-600 rounded px-3 py-1 text-sm">
                        <option value="all">All Logs</option>
                        <option value="deploy">Deployments</option>
                        <option value="verify">Verification</option>
                        <option value="error">Errors</option>
                        <option value="success">Success</option>
                    </select>
                    <button onclick="clearLogs()" class="text-red-400 hover:text-red-300 transition-colors">
                        <i class="fas fa-trash mr-2"></i>Clear
                    </button>
                    <button onclick="downloadLogs()" class="text-green-400 hover:text-green-300 transition-colors">
                        <i class="fas fa-download mr-2"></i>Download
                    </button>
                </div>
            </div>
            <div id="deploymentLogs" class="bg-black rounded-lg p-4 h-64 overflow-y-auto font-mono text-sm">
                <!-- Logs will be populated dynamically -->
            </div>
        </div>

        <!-- Advanced Deployment Tools -->
        <div class="grid lg:grid-cols-4 gap-6 mb-8">
            <!-- One-Click Deployment -->
            <div class="glass rounded-xl p-6 deployment-card">
                <h3 class="text-lg font-semibold mb-3 flex items-center">
                    <i class="fas fa-rocket mr-3 text-green-400"></i>One-Click Deploy
                </h3>
                <p class="text-sm opacity-80 mb-4">Deploy entire ecosystem with verification</p>
                <button onclick="oneClickDeploy()" class="w-full bg-gradient-to-r from-green-500 to-blue-600 hover:from-green-600 hover:to-blue-700 px-4 py-3 rounded-lg font-semibold transition-all">
                    <i class="fas fa-magic mr-2"></i>Deploy All
                </button>
            </div>

            <!-- Batch Verification -->
            <div class="glass rounded-xl p-6 deployment-card">
                <h3 class="text-lg font-semibold mb-3 flex items-center">
                    <i class="fas fa-check-double mr-3 text-purple-400"></i>Batch Verify
                </h3>
                <p class="text-sm opacity-80 mb-4">Verify all deployed contracts automatically</p>
                <button onclick="batchVerifyContracts()" class="w-full bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700 px-4 py-3 rounded-lg font-semibold transition-all">
                    <i class="fas fa-shield-alt mr-2"></i>Verify All
                </button>
            </div>

            <!-- Environment Manager -->
            <div class="glass rounded-xl p-6 deployment-card">
                <h3 class="text-lg font-semibold mb-3 flex items-center">
                    <i class="fas fa-cog mr-3 text-yellow-400"></i>Environment
                </h3>
                <select id="environmentSelect" class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 mb-3 text-sm">
                    <option value="base">Base Mainnet</option>
                    <option value="base-sepolia">Base Sepolia</option>
                    <option value="zora">Zora Network</option>
                    <option value="optimism">Optimism</option>
                </select>
                <button onclick="switchEnvironment()" class="w-full bg-yellow-600 hover:bg-yellow-700 px-4 py-2 rounded-lg font-semibold transition-colors">
                    Switch Network
                </button>
            </div>

            <!-- Contract Updater -->
            <div class="glass rounded-xl p-6 deployment-card">
                <h3 class="text-lg font-semibold mb-3 flex items-center">
                    <i class="fas fa-sync-alt mr-3 text-cyan-400"></i>Update Contracts
                </h3>
                <p class="text-sm opacity-80 mb-4">Update contract configurations and metadata</p>
                <button onclick="updateContracts()" class="w-full bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 px-4 py-3 rounded-lg font-semibold transition-all">
                    <i class="fas fa-upload mr-2"></i>Update All
                </button>
            </div>
        </div>
    </div>

    <!-- Enhanced Deployment Modal -->
    <div id="deploymentModal" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="glass rounded-xl p-6 max-w-2xl w-full">
                <h3 class="text-2xl font-semibold mb-4" id="modalTitle">Deploying...</h3>
                <div class="space-y-4">
                    <div class="w-full bg-gray-700 rounded-full h-4">
                        <div class="progress-bar" id="modalProgress" style="width: 0%"></div>
                    </div>
                    <div id="modalContent" class="text-sm opacity-80">
                        Preparing deployment...
                    </div>
                    <div id="deploymentSteps" class="mt-4">
                        <!-- Dynamic deployment steps will be shown here -->
                    </div>
                </div>
                <div class="flex justify-end space-x-3 mt-6">
                    <button onclick="cancelDeployment()" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg transition-colors">
                        Cancel
                    </button>
                    <button onclick="closeModal()" class="bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded-lg transition-colors">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Enhanced Deployment Dashboard Controller
        class AdvancedDeploymentDashboard {
            constructor() {
                this.contracts = {};
                this.activeDeployments = new Map();
                this.verificationQueue = new Map();
                this.deploymentHistory = [];
                this.logs = [];
                this.autoRefresh = true;
                this.refreshInterval = null;
                this.currentEnvironment = 'base';
                this.gasTracker = {
                    current: 0,
                    optimal: 0,
                    average: 0
                };
                this.networkStats = {
                    blockHeight: 0,
                    blockTime: '2s',
                    health: 'good'
                };
                this.init();
            }

            async init() {
                this.addLog('SYSTEM', 'Initializing Advanced Deployment Dashboard...', 'info');
                document.getElementById('initTime').textContent = new Date().toLocaleString();
                
                await this.waitForDependencies();
                await this.loadContractConfigs();
                await this.checkAllStatus();
                await this.loadGasData();
                await this.loadNetworkStats();
                
                this.setupRealTimeUpdates();
                this.renderAll();
                
                document.getElementById('systemStatus').className = 'status-indicator status-deployed';
                document.getElementById('systemStatusText').textContent = 'System Online';
                
                this.addLog('SYSTEM', 'Advanced deployment dashboard fully initialized', 'success');
                this.updateTimestamp();
            }

            async waitForDependencies() {
                let attempts = 0;
                while (typeof ethers === 'undefined' && attempts < 100) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                    attempts++;
                }
                
                if (typeof TRUTH_CONTRACTS === 'undefined') {
                    window.TRUTH_CONTRACTS = {
                        ADDRESSES: {
                            TruthToken: '0x8f6cf6f7747e170f4768533b869c339dc3d30a3c',
                            CreatorToken: '0x22b0434e89882f8e6841d340b28427646c015aa7',
                            TheTruth: '0x...',
                            TruthBonusGift: '0x...',
                            TruthPartThree: '0x...',
                            PaymentSplitter: '0x...'
                        },
                        NETWORK: { rpcUrl: 'https://mainnet.base.org' }
                    };
                }
            }

            async loadContractConfigs() {
                this.contracts = {
                    TruthToken: {
                        name: 'TRUTH Token',
                        description: 'Main governance token',
                        status: 'deployed',
                        verificationStatus: 'verified',
                        address: '0x8f6cf6f7747e170f4768533b869c339dc3d30a3c',
                        network: 'Base/Zora',
                        gasUsed: 2100000,
                        deploymentCost: '$125',
                        value: '$50,000',
                        deployedAt: '2024-01-15T10:30:00Z',
                        verifiedAt: '2024-01-15T10:45:00Z'
                    },
                    CreatorToken: {
                        name: 'Creator Token',
                        description: 'Community access token',
                        status: 'deployed',
                        verificationStatus: 'verified',
                        address: '0x22b0434e89882f8e6841d340b28427646c015aa7',
                        network: 'Base/Zora',
                        gasUsed: 1900000,
                        deploymentCost: '$95',
                        value: '$25,000',
                        deployedAt: '2024-01-15T11:00:00Z',
                        verifiedAt: '2024-01-15T11:15:00Z'
                    },
                    TheTruth: {
                        name: 'The Truth NFT',
                        description: 'Main NFT collection (77 editions)',
                        status: 'not-deployed',
                        verificationStatus: 'unverified',
                        address: '',
                        network: 'Base',
                        gasUsed: 2500000,
                        estimatedCost: '$150',
                        value: '$0',
                        maxSupply: 77,
                        features: ['Immutable Metadata', 'Revenue Sharing', 'Provenance Hash']
                    },
                    TruthBonusGift: {
                        name: 'Bonus Gift NFT',
                        description: 'Community collection (145,000 editions)',
                        status: 'not-deployed',
                        verificationStatus: 'unverified',
                        address: '',
                        network: 'Base',
                        gasUsed: 2200000,
                        estimatedCost: '$130',
                        value: '$0',
                        maxSupply: 145000,
                        features: ['Bulk Minting', 'Whitelist Support', 'Royalty Enforcement']
                    },
                    TruthPartThree: {
                        name: 'Part Three NFT',
                        description: 'Extended collection (444 editions)',
                        status: 'not-deployed',
                        verificationStatus: 'unverified',
                        address: '',
                        network: 'Base',
                        gasUsed: 2300000,
                        estimatedCost: '$140',
                        value: '$0',
                        maxSupply: 444,
                        features: ['Dynamic Pricing', 'Staking Rewards', 'DAO Governance']
                    },
                    PaymentSplitter: {
                        name: 'Payment Splitter',
                        description: 'Revenue distribution contract',
                        status: 'not-deployed',
                        verificationStatus: 'unverified',
                        address: '',
                        network: 'Base',
                        gasUsed: 800000,
                        estimatedCost: '$50',
                        value: '$0',
                        features: ['Multi-sig Support', 'Automated Distribution', 'Fee Management']
                    }
                };
            }

            async checkAllStatus() {
                this.addLog('STATUS', 'Checking all contract deployment status...', 'info');
                
                for (const [key, contract] of Object.entries(this.contracts)) {
                    await this.checkContractStatus(key);
                }
                
                this.updateOverview();
                this.addLog('STATUS', 'Status check completed for all contracts', 'success');
            }

            async checkContractStatus(contractKey) {
                if (contractKey === 'TruthToken' || contractKey === 'CreatorToken') {
                    this.contracts[contractKey].status = 'deployed';
                    this.contracts[contractKey].verificationStatus = 'verified';
                    return;
                }

                const address = TRUTH_CONTRACTS.ADDRESSES[contractKey];
                if (!address || address === '0x...') {
                    this.contracts[contractKey].status = 'not-deployed';
                    this.contracts[contractKey].verificationStatus = 'unverified';
                    return;
                }

                try {
                    const provider = new ethers.providers.JsonRpcProvider(TRUTH_CONTRACTS.NETWORK.rpcUrl);
                    const code = await provider.getCode(address);
                    
                    if (code === '0x') {
                        this.contracts[contractKey].status = 'failed';
                        this.contracts[contractKey].verificationStatus = 'unverified';
                    } else {
                        this.contracts[contractKey].status = 'deployed';
                        this.contracts[contractKey].address = address;
                        // Check verification status (mock for now)
                        this.contracts[contractKey].verificationStatus = 'unverified';
                    }
                } catch (error) {
                    this.contracts[contractKey].status = 'failed';
                    this.contracts[contractKey].verificationStatus = 'unverified';
                    this.addLog('ERROR', `Failed to check ${contractKey}: ${error.message}`, 'error');
                }
            }

            updateOverview() {
                const contracts = Object.values(this.contracts);
                const deployed = contracts.filter(c => c.status === 'deployed').length;
                const deploying = contracts.filter(c => c.status === 'deploying').length;
                const verifying = contracts.filter(c => c.verificationStatus === 'verifying').length;
                const verified = contracts.filter(c => c.verificationStatus === 'verified').length;
                const total = contracts.length;

                document.getElementById('contractsDeployed').textContent = `${deployed}/${total}`;
                document.getElementById('contractsDeploying').textContent = deploying;
                document.getElementById('contractsVerifying').textContent = verifying;
                document.getElementById('contractsVerified').textContent = verified;
                
                const contractProgress = (deployed / total) * 100;
                document.getElementById('contractProgress').style.width = `${contractProgress}%`;

                // Calculate total gas used
                const totalGas = contracts.reduce((sum, c) => sum + (c.gasUsed || 0), 0);
                document.getElementById('totalGasUsed').textContent = `${(totalGas / 1000000).toFixed(1)}M`;

                // Calculate total value
                const totalValue = contracts
                    .filter(c => c.status === 'deployed')
                    .reduce((sum, c) => sum + parseInt(c.value.replace(/[$,]/g, '') || 0), 0);
                document.getElementById('totalValue').textContent = `$${totalValue.toLocaleString()}`;

                document.getElementById('contractUpdateTime').textContent = `Updated: ${new Date().toLocaleTimeString()}`;
            }

            renderAll() {
                this.renderContractGrid();
                this.renderActiveDeployments();
                this.renderVerificationStatus();
                this.updateLogCount();
            }

            renderContractGrid() {
                const grid = document.getElementById('contractGrid');
                grid.innerHTML = Object.entries(this.contracts).map(([key, contract]) => `
                    <div class="deployment-card glass rounded-lg p-4 hover:bg-white hover:bg-opacity-5">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex items-start flex-1">
                                <span class="status-indicator status-${contract.status}"></span>
                                <div class="flex-1">
                                    <div class="flex items-center">
                                        <span class="font-semibold">${contract.name}</span>
                                        <span class="network-badge badge-${contract.network.toLowerCase().replace('/', '-')}">${contract.network}</span>
                                    </div>
                                    <div class="text-sm opacity-80 mt-1">${contract.description}</div>
                                    ${contract.features ? `<div class="text-xs opacity-60 mt-1">Features: ${contract.features.join(', ')}</div>` : ''}
                                </div>
                            </div>
                            <div class="flex flex-col space-y-2 ml-4">
                                ${contract.status === 'not-deployed' ? 
                                    `<button onclick="dashboard.deployContract('${key}')" class="bg-green-600 hover:bg-green-700 px-3 py-1 rounded text-xs transition-colors whitespace-nowrap">
                                        <i class="fas fa-rocket mr-1"></i>Deploy
                                    </button>` : 
                                    `<button onclick="dashboard.viewContract('${key}')" class="bg-blue-600 hover:bg-blue-700 px-3 py-1 rounded text-xs transition-colors whitespace-nowrap">
                                        <i class="fas fa-eye mr-1"></i>View
                                    </button>`
                                }
                                ${contract.status === 'deployed' && contract.verificationStatus === 'unverified' ?
                                    `<button onclick="dashboard.verifyContract('${key}')" class="bg-purple-600 hover:bg-purple-700 px-3 py-1 rounded text-xs transition-colors whitespace-nowrap">
                                        <i class="fas fa-shield-alt mr-1"></i>Verify
                                    </button>` : ''
                                }
                            </div>
                        </div>
                        
                        <div class="flex items-center justify-between text-xs opacity-60 mb-2">
                            <span>${contract.address ? `${contract.address.slice(0, 6)}...${contract.address.slice(-4)}` : 'Not deployed'}</span>
                            ${contract.verificationStatus !== 'unverified' ? `<span class="verification-badge ${contract.verificationStatus}">
                                <i class="fas fa-${contract.verificationStatus === 'verified' ? 'check-circle' : 'clock'} mr-1"></i>
                                ${contract.verificationStatus.charAt(0).toUpperCase() + contract.verificationStatus.slice(1)}
                            </span>` : ''}
                        </div>

                        ${contract.status === 'deployed' ? `
                            <div class="contract-metrics">
                                <div class="metric-item">
                                    <div class="metric-value">${(contract.gasUsed / 1000000).toFixed(1)}M</div>
                                    <div class="metric-label">Gas Used</div>
                                </div>
                                <div class="metric-item">
                                    <div class="metric-value">${contract.deploymentCost || contract.estimatedCost}</div>
                                    <div class="metric-label">Cost</div>
                                </div>
                                <div class="metric-item">
                                    <div class="metric-value">${contract.value}</div>
                                    <div class="metric-label">Value</div>
                                </div>
                                ${contract.maxSupply ? `
                                <div class="metric-item">
                                    <div class="metric-value">${contract.maxSupply.toLocaleString()}</div>
                                    <div class="metric-label">Max Supply</div>
                                </div>
                                ` : ''}
                            </div>
                        ` : `
                            <div class="contract-metrics">
                                <div class="metric-item">
                                    <div class="metric-value">${(contract.gasUsed / 1000000).toFixed(1)}M</div>
                                    <div class="metric-label">Est. Gas</div>
                                </div>
                                <div class="metric-item">
                                    <div class="metric-value">${contract.estimatedCost}</div>
                                    <div class="metric-label">Est. Cost</div>
                                </div>
                                ${contract.maxSupply ? `
                                <div class="metric-item">
                                    <div class="metric-value">${contract.maxSupply.toLocaleString()}</div>
                                    <div class="metric-label">Max Supply</div>
                                </div>
                                ` : ''}
                            </div>
                        `}
                    </div>
                `).join('');
            }

            renderActiveDeployments() {
                const deployments = document.getElementById('activeDeployments');
                
                if (this.activeDeployments.size === 0) {
                    deployments.innerHTML = `
                        <div class="text-center opacity-60 py-8">
                            <i class="fas fa-rocket text-4xl mb-3"></i>
                            <div>No active deployments</div>
                            <div class="text-sm">Deploy a contract to see live tracking</div>
                        </div>
                    `;
                    return;
                }

                deployments.innerHTML = Array.from(this.activeDeployments.entries()).map(([id, deployment]) => `
                    <div class="glass rounded-lg p-4">
                        <div class="flex items-center justify-between mb-3">
                            <div class="font-semibold">${deployment.contract}</div>
                            <div class="text-sm opacity-80">${deployment.progress}%</div>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-2 mb-3">
                            <div class="progress-bar" style="width: ${deployment.progress}%"></div>
                        </div>
                        <div class="space-y-2">
                            ${deployment.steps.map(step => `
                                <div class="deployment-step step-${step.status}">
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm">${step.name}</span>
                                        <span class="text-xs">
                                            ${step.status === 'completed' ? '‚úÖ' : 
                                              step.status === 'active' ? '‚è≥' : 
                                              step.status === 'failed' ? '‚ùå' : '‚è∏Ô∏è'}
                                        </span>
                                    </div>
                                    ${step.details ? `<div class="text-xs opacity-60 mt-1">${step.details}</div>` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `).join('');
            }

            renderVerificationStatus() {
                const verificationDiv = document.getElementById('verificationStatus');
                const unverifiedContracts = Object.entries(this.contracts)
                    .filter(([key, contract]) => contract.status === 'deployed' && contract.verificationStatus === 'unverified');

                if (unverifiedContracts.length === 0) {
                    verificationDiv.innerHTML = `
                        <div class="text-center opacity-60 py-4">
                            <i class="fas fa-shield-alt text-3xl mb-2 text-green-400"></i>
                            <div>All contracts verified!</div>
                        </div>
                    `;
                    return;
                }

                verificationDiv.innerHTML = unverifiedContracts.map(([key, contract]) => `
                    <div class="flex items-center justify-between p-2 bg-purple-900 bg-opacity-20 rounded">
                        <div>
                            <div class="text-sm font-semibold">${contract.name}</div>
                            <div class="text-xs opacity-60">${contract.address.slice(0, 10)}...</div>
                        </div>
                        <button onclick="dashboard.verifyContract('${key}')" class="bg-purple-600 hover:bg-purple-700 px-2 py-1 rounded text-xs">
                            Verify
                        </button>
                    </div>
                `).join('');
            }

            async loadGasData() {
                try {
                    // Mock gas data - in production, fetch from gas station API
                    this.gasTracker = {
                        current: 15 + Math.random() * 10,
                        optimal: 12,
                        average: 18,
                        estimatedCost: 45 + Math.random() * 20
                    };

                    document.getElementById('currentGas').textContent = `${Math.round(this.gasTracker.current)} gwei`;
                    document.getElementById('optimalTime').textContent = this.gasTracker.current < 20 ? 'Now (Good)' : 'Later (High)';
                    document.getElementById('estimatedCost').textContent = `$${Math.round(this.gasTracker.estimatedCost)} USD`;
                    document.getElementById('averageGas').textContent = `${Math.round(this.gasTracker.average)} gwei`;
                } catch (error) {
                    this.addLog('ERROR', 'Failed to load gas data', 'error');
                }
            }

            async loadNetworkStats() {
                try {
                    const provider = new ethers.providers.JsonRpcProvider(TRUTH_CONTRACTS.NETWORK.rpcUrl);
                    this.networkStats.blockHeight = await provider.getBlockNumber();
                    
                    document.getElementById('blockHeight').textContent = this.networkStats.blockHeight.toLocaleString();
                    document.getElementById('baseStatus').textContent = 'üü¢ Online';
                    document.getElementById('blockTime').textContent = '~2s';
                    document.getElementById('networkLoad').textContent = 'Normal';
                    
                    this.addLog('NETWORK', `Network stats updated - Block: ${this.networkStats.blockHeight}`, 'info');
                } catch (error) {
                    document.getElementById('baseStatus').textContent = 'üî¥ Error';
                    this.addLog('ERROR', 'Failed to load network stats', 'error');
                }
            }

            setupRealTimeUpdates() {
                if (this.autoRefresh) {
                    this.refreshInterval = setInterval(() => {
                        this.checkAllStatus();
                        this.loadGasData();
                        this.loadNetworkStats();
                        this.updateTimestamp();
                    }, 30000);
                }
            }

            updateTimestamp() {
                document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString();
            }

            addLog(type, message, level = 'info', contractName = null) {
                const timestamp = new Date().toISOString();
                const logEntry = {
                    timestamp,
                    type,
                    message,
                    level,
                    contractName,
                    id: Date.now() + Math.random()
                };
                
                this.logs.unshift(logEntry);
                
                // Keep only last 100 logs
                if (this.logs.length > 100) {
                    this.logs = this.logs.slice(0, 100);
                }
                
                this.renderLogs();
                this.updateLogCount();
                
                // Add to timeline
                this.addToTimeline(type, message, level);
            }

            renderLogs() {
                const logsContainer = document.getElementById('deploymentLogs');
                const filter = document.getElementById('logFilter')?.value || 'all';
                
                let filteredLogs = this.logs;
                if (filter !== 'all') {
                    filteredLogs = this.logs.filter(log => 
                        log.level === filter || log.type.toLowerCase() === filter
                    );
                }
                
                const colors = {
                    success: 'text-green-400',
                    error: 'text-red-400',
                    warning: 'text-yellow-400',
                    info: 'text-blue-400'
                };
                
                logsContainer.innerHTML = filteredLogs.map(log => {
                    const time = new Date(log.timestamp).toLocaleTimeString();
                    return `<div class="${colors[log.level] || 'text-white'}">[${time}] [${log.type}] ${log.message}</div>`;
                }).join('');
                
                // Auto-scroll to bottom for new logs
                logsContainer.scrollTop = logsContainer.scrollHeight;
            }

            updateLogCount() {
                document.getElementById('logCount').textContent = `(${this.logs.length} entries)`;
            }

            addToTimeline(type, message, level) {
                const timeline = document.getElementById('deploymentTimeline');
                const timelineItem = document.createElement('div');
                timelineItem.className = 'timeline-item';
                timelineItem.innerHTML = `
                    <div class="text-sm ${level === 'error' ? 'text-red-400' : level === 'success' ? 'text-green-400' : 'opacity-80'}">[${type}] ${message}</div>
                    <div class="text-xs opacity-60">${new Date().toLocaleString()}</div>
                `;
                timeline.appendChild(timelineItem);
            }

            // Enhanced deployment methods
            async deployContract(contractKey) {
                const contract = this.contracts[contractKey];
                this.addLog('DEPLOY', `Starting deployment of ${contract.name}`, 'info', contractKey);
                
                // Create active deployment tracking
                const deploymentId = `deploy_${contractKey}_${Date.now()}`;
                this.activeDeployments.set(deploymentId, {
                    contract: contract.name,
                    progress: 0,
                    steps: [
                        { name: 'Preparing deployment', status: 'active', details: 'Validating parameters...' },
                        { name: 'Compiling contract', status: 'pending' },
                        { name: 'Estimating gas', status: 'pending' },
                        { name: 'Deploying to network', status: 'pending' },
                        { name: 'Waiting for confirmation', status: 'pending' },
                        { name: 'Updating configuration', status: 'pending' }
                    ]
                });

                this.contracts[contractKey].status = 'deploying';
                this.renderAll();

                try {
                    // Open MetaMask deployment window
                    window.open('/deploy.html', '_blank');
                    
                    // Simulate deployment progress
                    await this.simulateDeploymentProgress(deploymentId, contractKey);
                    
                    this.addLog('DEPLOY', `${contract.name} deployment window opened`, 'success', contractKey);
                } catch (error) {
                    this.addLog('DEPLOY', `Failed to deploy ${contract.name}: ${error.message}`, 'error', contractKey);
                    this.contracts[contractKey].status = 'failed';
                    this.activeDeployments.delete(deploymentId);
                    this.renderAll();
                }
            }

            async simulateDeploymentProgress(deploymentId, contractKey) {
                const deployment = this.activeDeployments.get(deploymentId);
                if (!deployment) return;

                for (let i = 0; i < deployment.steps.length; i++) {
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    deployment.steps[i].status = 'completed';
                    if (i + 1 < deployment.steps.length) {
                        deployment.steps[i + 1].status = 'active';
                    }
                    
                    deployment.progress = Math.round(((i + 1) / deployment.steps.length) * 100);
                    this.renderActiveDeployments();
                }

                // Complete deployment
                setTimeout(() => {
                    this.activeDeployments.delete(deploymentId);
                    this.renderActiveDeployments();
                }, 3000);
            }

            async verifyContract(contractKey) {
                const contract = this.contracts[contractKey];
                this.addLog('VERIFY', `Starting verification of ${contract.name}`, 'info', contractKey);
                
                contract.verificationStatus = 'verifying';
                this.renderAll();

                // Simulate verification process
                setTimeout(() => {
                    contract.verificationStatus = 'verified';
                    contract.verifiedAt = new Date().toISOString();
                    this.addLog('VERIFY', `${contract.name} successfully verified`, 'success', contractKey);
                    this.renderAll();
                }, 5000);
            }

            viewContract(contractKey) {
                const contract = this.contracts[contractKey];
                if (contract.address) {
                    const baseUrl = contract.network.includes('Base') ? 'https://basescan.org' : 'https://etherscan.io';
                    window.open(`${baseUrl}/address/${contract.address}`, '_blank');
                    this.addLog('VIEW', `Opened ${contract.name} on block explorer`, 'info', contractKey);
                }
            }

            // Global functions for UI
            async oneClickDeploy() {
                this.addLog('DEPLOY', 'Starting one-click deployment sequence...', 'info');
                
                const undeployedContracts = Object.entries(this.contracts)
                    .filter(([key, contract]) => contract.status === 'not-deployed');
                
                if (undeployedContracts.length === 0) {
                    this.addLog('DEPLOY', 'All contracts already deployed!', 'warning');
                    return;
                }
                
                this.addLog('DEPLOY', `Deploying ${undeployedContracts.length} contracts in sequence`, 'info');
                
                for (const [key] of undeployedContracts) {
                    await this.deployContract(key);
                    await new Promise(resolve => setTimeout(resolve, 3000));
                }
            }

            async batchVerifyContracts() {
                this.addLog('VERIFY', 'Starting batch verification...', 'info');
                
                const unverifiedContracts = Object.entries(this.contracts)
                    .filter(([key, contract]) => contract.status === 'deployed' && contract.verificationStatus === 'unverified');
                
                if (unverifiedContracts.length === 0) {
                    this.addLog('VERIFY', 'All deployed contracts already verified!', 'warning');
                    return;
                }

                for (const [key] of unverifiedContracts) {
                    await this.verifyContract(key);
                }
            }

            exportTimeline() {
                const timelineData = this.logs.map(log => ({
                    timestamp: log.timestamp,
                    type: log.type,
                    message: log.message,
                    level: log.level,
                    contract: log.contractName
                }));

                const dataStr = JSON.stringify(timelineData, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                
                const exportFileDefaultName = `deployment-timeline-${new Date().toISOString().slice(0, 10)}.json`;
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileDefaultName);
                linkElement.click();
                
                this.addLog('EXPORT', 'Timeline exported successfully', 'success');
            }

            filterLogs() {
                this.renderLogs();
            }

            clearLogs() {
                this.logs = [];
                this.renderLogs();
                this.updateLogCount();
                this.addLog('SYSTEM', 'Deployment logs cleared', 'info');
            }

            downloadLogs() {
                const logsText = this.logs.map(log => 
                    `[${new Date(log.timestamp).toLocaleString()}] [${log.type}] ${log.message}`
                ).join('\n');

                const blob = new Blob([logsText], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `deployment-logs-${new Date().toISOString().slice(0, 10)}.txt`;
                a.click();
                URL.revokeObjectURL(url);
                
                this.addLog('EXPORT', 'Logs downloaded successfully', 'success');
            }

            toggleAutoRefresh() {
                this.autoRefresh = !this.autoRefresh;
                const btn = document.getElementById('autoRefreshBtn');
                
                if (this.autoRefresh) {
                    this.setupRealTimeUpdates();
                    btn.innerHTML = '<i class="fas fa-pause mr-2"></i>Auto: ON';
                    btn.className = 'bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg transition-colors';
                } else {
                    if (this.refreshInterval) {
                        clearInterval(this.refreshInterval);
                    }
                    btn.innerHTML = '<i class="fas fa-play mr-2"></i>Auto: OFF';
                    btn.className = 'bg-gray-600 hover:bg-gray-700 px-4 py-2 rounded-lg transition-colors';
                }
                
                this.addLog('SYSTEM', `Auto-refresh ${this.autoRefresh ? 'enabled' : 'disabled'}`, 'info');
            }

            switchEnvironment() {
                const newEnv = document.getElementById('environmentSelect').value;
                this.currentEnvironment = newEnv;
                document.getElementById('currentNetwork').textContent = newEnv.charAt(0).toUpperCase() + newEnv.slice(1);
                this.addLog('SYSTEM', `Switched to ${newEnv} environment`, 'info');
                this.checkAllStatus();
            }

            async checkNetworkHealth() {
                this.addLog('NETWORK', 'Performing comprehensive network health check...', 'info');
                await this.loadNetworkStats();
                this.addLog('NETWORK', 'Network health check completed', 'success');
            }

            optimizeGas() {
                this.addLog('GAS', 'Analyzing optimal deployment timing...', 'info');
                setTimeout(() => {
                    this.addLog('GAS', `Current gas (${Math.round(this.gasTracker.current)} gwei) is ${this.gasTracker.current < 20 ? 'optimal' : 'high'} for deployment`, 'success');
                }, 1000);
            }

            updateContracts() {
                this.addLog('UPDATE', 'Updating contract configurations...', 'info');
                setTimeout(() => {
                    this.addLog('UPDATE', 'All contract configurations updated successfully', 'success');
                    this.checkAllStatus();
                }, 2000);
            }

            showModal(title, content) {
                document.getElementById('modalTitle').textContent = title;
                document.getElementById('modalContent').innerHTML = content;
                document.getElementById('deploymentModal').classList.remove('hidden');
            }

            closeModal() {
                document.getElementById('deploymentModal').classList.add('hidden');
            }

            cancelDeployment() {
                this.addLog('DEPLOY', 'Deployment cancelled by user', 'warning');
                this.closeModal();
            }
        }

        // Initialize enhanced dashboard
        const dashboard = new AdvancedDeploymentDashboard();

        // Global functions
        async function refreshAllStatus() {
            await dashboard.checkAllStatus();
            dashboard.renderAll();
        }

        async function oneClickDeploy() {
            await dashboard.oneClickDeploy();
        }

        async function batchVerifyContracts() {
            await dashboard.batchVerifyContracts();
        }

        function verifyAllContracts() {
            dashboard.batchVerifyContracts();
        }

        function toggleAutoRefresh() {
            dashboard.toggleAutoRefresh();
        }

        function switchEnvironment() {
            dashboard.switchEnvironment();
        }

        function checkNetworkHealth() {
            dashboard.checkNetworkHealth();
        }

        function optimizeGas() {
            dashboard.optimizeGas();
        }

        function updateContracts() {
            dashboard.updateContracts();
        }

        function exportTimeline() {
            dashboard.exportTimeline();
        }

        function filterLogs() {
            dashboard.filterLogs();
        }

        function clearLogs() {
            dashboard.clearLogs();
        }

        function downloadLogs() {
            dashboard.downloadLogs();
        }

        function closeModal() {
            dashboard.closeModal();
        }

        function cancelDeployment() {
            dashboard.cancelDeployment();
        }
    </script>
</body>
</html>
